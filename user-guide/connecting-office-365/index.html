<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-user-guide/connecting-office-365">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Log in to Microsoft 365 - CLI for Microsoft 365</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://clidemo.github.io/cli-microsoft365-docusaurus/user-guide/connecting-office-365"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Log in to Microsoft 365 - CLI for Microsoft 365"><meta data-rh="true" name="description" content="Before you can use CLI for Microsoft 365 commands to manage your tenant, you have to log in to Microsoft 365. Following section explains how you can log in and check the Microsoft 365 login status."><meta data-rh="true" property="og:description" content="Before you can use CLI for Microsoft 365 commands to manage your tenant, you have to log in to Microsoft 365. Following section explains how you can log in and check the Microsoft 365 login status."><link data-rh="true" rel="icon" href="/cli-microsoft365-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://clidemo.github.io/cli-microsoft365-docusaurus/user-guide/connecting-office-365"><link data-rh="true" rel="alternate" href="https://clidemo.github.io/cli-microsoft365-docusaurus/user-guide/connecting-office-365" hreflang="en"><link data-rh="true" rel="alternate" href="https://clidemo.github.io/cli-microsoft365-docusaurus/user-guide/connecting-office-365" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://MYVIRG3SD4-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="CLI for Microsoft 365" href="/cli-microsoft365-docusaurus/opensearch.xml"><link rel="stylesheet" href="/cli-microsoft365-docusaurus/assets/css/styles.0c5a7ff0.css">
<link rel="preload" href="/cli-microsoft365-docusaurus/assets/js/runtime~main.4be4188f.js" as="script">
<link rel="preload" href="/cli-microsoft365-docusaurus/assets/js/main.4e021339.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cli-microsoft365-docusaurus/"><div class="navbar__logo"><img src="/cli-microsoft365-docusaurus/img/pnp-cli-microsoft365-white.svg" alt="CLI for Microsoft 365 Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cli-microsoft365-docusaurus/img/pnp-cli-microsoft365-white.svg" alt="CLI for Microsoft 365 Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cli-microsoft365-docusaurus/user-guide">User Guide</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/cmd">Commands</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/concepts">Concepts</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/sample-scripts">Sample Scripts</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/cli-microsoft365-docusaurus/user-guide">User Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/installing-cli">Install the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/using-cli">Use the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/run-cli-in-docker-container">Run CLI in a Docker Container</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/connecting-office-365">Log in to Microsoft 365</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/cli-output-mode">CLI output mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/filter-cli-data">Filter CLI data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/configuring-cli">Configure CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/completion">Command completion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/using-own-identity">Use your own Azure AD identity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/cli-certificate-caveats">Caveats when working with the CLI and certificate login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/github-actions">Automate your CI/CD workflow using CLI for Microsoft 365 GitHub Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/manage-microsoft-365-apps">Manage Microsoft 365 apps with the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli-microsoft365-docusaurus/user-guide/use-cli-api">Use CLI programmatically</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cli-microsoft365-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cli-microsoft365-docusaurus/user-guide"><span itemprop="name">User Guide</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Log in to Microsoft 365</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Log in to Microsoft 365</h1><p>Before you can use CLI for Microsoft 365 commands to manage your tenant, you have to log in to Microsoft 365. Following section explains how you can log in and check the Microsoft 365 login status.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="microsoft-365-services">Microsoft 365 services<a class="hash-link" href="#microsoft-365-services" title="Direct link to heading">​</a></h2><p>Using the CLI for Microsoft 365 you can manage different areas of an Microsoft 365 tenant. Currently, commands for working with SharePoint Online, Azure Active Directory, Microsoft Graph and the Azure Management Service are available, but more commands for other services will be added in the future.</p><p>Commands in the CLI for Microsoft 365 are organized into services. For example, all commands that manage SharePoint Online begin with <code>spo</code> (<code>spo app list</code>, <code>spo cdn get</code>, etc.) and commands for working with the Azure AD begin with <code>aad</code>. After logging in to Microsoft 365, you can communicate with any Microsoft 365 service supported by the CLI for Microsoft 365 and it will automatically retrieve the necessary access token.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-to-microsoft-365-1">Log in to Microsoft 365<a class="hash-link" href="#log-in-to-microsoft-365-1" title="Direct link to heading">​</a></h3><p>CLI for Microsoft 365 offers you a number of ways to log in to Microsoft 365.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-using-the-default-device-code-flow">Log in using the default device code flow<a class="hash-link" href="#log-in-using-the-default-device-code-flow" title="Direct link to heading">​</a></h4><p>The default way to log in to Microsoft 365 using the CLI for Microsoft 365 is through the device code flow. To log in to Microsoft 365, use the <code>login</code> command.</p><p>After executing the <code>login</code> command, you will be prompted to navigate to <em><a href="https://aka.ms/devicelogin" target="_blank" rel="noopener noreferrer">https://aka.ms/devicelogin</a></em> in your web browser and enter the login code presented to you by the CLI for Microsoft 365 in the command line. After entering the code, you will see the prompt that you are about to authenticate the <em>PnP Microsoft 365 Management Shell</em> application to access your tenant on your behalf.</p><p>If you are using the CLI for Microsoft 365 for the first time, you will be also prompted to verify the permissions you are about to grant the CLI for Microsoft 365. This is referred to as <em>consent</em>.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/consent-1c5eaccf25b556f896114e67fd99fd5c.png"><img loading="lazy" alt="Granting the CLI for Microsoft 365 the necessary permissions" src="/cli-microsoft365-docusaurus/assets/images/consent-1c5eaccf25b556f896114e67fd99fd5c.png" width="1704" height="1360" class="img_ev3q"></a></p><p>The device code flow is the recommended approach for command-line tools to authenticate with resources secured with Azure AD. Because the authentication process is handled in the browser by Azure AD itself, it allows you to benefit of rich security features such as multi-factor authentication or conditional access. The device code flow is interactive and requires user interaction which might be limiting if you want to use the CLI for Microsoft 365 in your continuous deployment setup which is fully automated and doesn&#x27;t involve user interaction.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-using-user-name-and-password">Log in using user name and password<a class="hash-link" href="#log-in-using-user-name-and-password" title="Direct link to heading">​</a></h4><p>An alternative way to log in to Microsoft 365 in the CLI for Microsoft 365 is by using a user name and password. To use this way of authenticating, set the <code>authType</code> option to <code>password</code> and specify your credentials using the <code>userName</code> and <code>password</code> options.</p><p>To log in to Microsoft 365 using your user name and password, execute:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">m365 login --authType password --userName user@contoso.com --password pass@word1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using credentials to log in to Microsoft 365 is convenient in automation scenarios where you cannot authenticate interactively. The downside of this way of authenticating is, that it doesn&#x27;t allow you to use any of the advanced security features that Azure AD offers. If your account for example uses multi-factor authentication, logging in to Microsoft 365 using credentials will fail.</p><p>!!! attention
When logging in to Microsoft 365 using credentials, CLI for Microsoft 365 will persist not only the retrieved access and refresh token, but also the credentials you specified when logging in. This is necessary for the CLI to be able to retrieve a new refresh token, in case the previously retrieved refresh token expired or has been invalidated.</p><p>Generally, you should use the default device code flow. If you need to use a non-interactive authentication flow, you can authenticate using a certificate or credentials of an account that has sufficient privileges in your tenant and doesn&#x27;t have multi-factor authentication or other advanced security features enabled.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-using-a-certificate">Log in using a certificate<a class="hash-link" href="#log-in-using-a-certificate" title="Direct link to heading">​</a></h4><p>Another way to log in to Microsoft 365 in the CLI for Microsoft 365 is by using a certificate. To use this authentication method, set the <code>CLIMICROSOFT365_AADAPPID</code> environment variable to the ID of the Azure AD application that you want to use to authenticate the CLI for Microsoft 365 and the <code>CLIMICROSOFT365_TENANT</code> environment variable to the ID of your Azure AD directory. When calling the login command, set the <code>authType</code> option to <code>certificate</code> and specify the path to the certificate private key using the <code>certificateFile</code> option. Optionally, you can specify the certificate&#x27;s thumbprint using the <code>thumbprint</code> option. If not specified, CLI will automatically calculate it from the specified certificate.</p><p>To log in to Microsoft 365 using a Personal Information Exchange (.pfx) file, execute:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">m365 login --authType certificate --certificateFile /Users/user/dev/localhost.pfx --password &#x27;pass@word1&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To log in to Microsoft 365 using a Privacy Enhanced Mail (PEM) certificate, execute:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">m365 login --authType certificate --certificateFile /Users/user/dev/localhost.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Logging in to Microsoft 365 using a certificate is convenient for automation scenarios where you cannot authenticate interactively but also don&#x27;t want to use credentials.</p><p>Because there is no user context when logging in using a certificate, you will typically create a new Azure AD application, specific to your organization and grant it the required permissions.</p><p>!!! attention
You should keep in mind, that because the CLI for Microsoft 365 will be accessing these APIs with app-only context, you need to grant the correct application permissions rather than delegated permissions that would be used in other authentication methods.</p><p>Logging in using a certificate gives the CLI for Microsoft 365 app-only access to Microsoft 365 services. Not all operations support app-only access so it is possible, that some CLI commands will fail when executed while logged in to Microsoft 365 using a certificate.</p><p>!!! attention
When logging in to Microsoft 365 using a certificate, CLI for Microsoft 365 will persist not only the retrieved access token but also the contents of the certificate&#x27;s private key and its thumbprint. This is necessary for the CLI to be able to retrieve a new access token in case of the previously retrieved access token expired or has been invalidated.</p><p>Generally, you should use the default device code flow. If you need to use a non-interactive authentication flow, to for example integrate the CLI for Microsoft 365 in your build pipeline, you can login using a certificate or user credentials.</p><p>!!! attention
PFX files exported from a Windows key store will not work as they are protected with either a password or Active Directory account. The private key must either be exported from the protected .pfx or newly created using 3rd party tools like OpenSSL (<a href="https://www.openssl.org/" target="_blank" rel="noopener noreferrer">https://www.openssl.org/</a>).</p><p>Create a new self signed certificate:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout privateKey.key -out certificate.cer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a new Personal Information Exchange (.pfx) file</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">openssl pkcs12 -export -out protected.pfx -inkey privateKey.key -in certificate.cer -password pass:&quot;pass@word1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point the <code>protected.pfx</code> file can be used to log in the CLI for Microsoft 365 following the instructions above for logging in using a .pfx file.</p><p>If login with the .pfx file does not work then extract the private key from a protected .pfx and unprotect it:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">openssl pkcs12 -in protected.pfx -out privateKeyWithPassphrase.pem -nodes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point the <code>privateKeyWithPassphrase.pem</code> file can be used to log in the CLI for Microsoft 365 following the instructions above for logging in using a PEM certificate.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-using-a-secret">Log in using a secret<a class="hash-link" href="#log-in-using-a-secret" title="Direct link to heading">​</a></h4><p>CLI for Microsoft 365 also supports login using a secret. To use this authentication method, set the <code>CLIMICROSOFT365_AADAPPID</code> environment variable to the ID of the Azure AD application that you want to use to authenticate the CLI for Microsoft 365 and the <code>CLIMICROSOFT365_TENANT</code> environment variable to the ID of your Azure AD directory. When calling the login command, set the <code>authType</code> option to <code>secret</code> and specify the client secret value. </p><p>To log in to Microsoft 365 using a secret, execute:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">m365 login --authType secret --secret topSeCr3t@007</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Logging in to Microsoft 365 using a secret is convenient for automation scenarios where you cannot authenticate interactively but also don&#x27;t want to use credentials.</p><p>Because there is no user context when logging in using a secret, you will typically create a new Azure AD application, specific to your organization and grant it the required permissions.</p><p>!!! attention
You should keep in mind, that because the CLI for Microsoft 365 will be accessing these APIs with app-only context, you need to grant the correct application permissions rather than delegated permissions that would be used in other authentication methods.</p><p>Logging in using a secret gives the CLI for Microsoft 365 app-only access to Microsoft 365 services. Not all operations support app-only access so it is possible, that some CLI commands will fail when executed while logged in to Microsoft 365 using a secret.</p><p>!!! attention
Currently, SharePoint does not support authentication using Azure AD App ID and Secret. CLI for Microsoft 365 commands that call the SharePoint APIs will fail while logged in to Microsoft 365 using a Secret.</p><p>!!! attention
When logging in to Microsoft 365 using a secret, CLI for Microsoft 365 will persist not only the retrieved access token but also the secret. This is necessary for the CLI to be able to retrieve a new access token in case of the previously retrieved access token expired or has been invalidated.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-using-a-browser-authentication">Log in using a browser authentication<a class="hash-link" href="#log-in-using-a-browser-authentication" title="Direct link to heading">​</a></h4><p>Yet another way to log in to Microsoft 365 in the CLI for Microsoft 365 is by using a an interactive browser authentication. To use this authentication method, call the login command with the <code>authType</code> option set to <code>browser</code>:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">m365 login --authType browser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This option is especially useful if you have conditional access policies configured in your tenant but you can also use it instead of the default device code flow.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-login-status">Check login status<a class="hash-link" href="#check-login-status" title="Direct link to heading">​</a></h3><p>To see if you&#x27;re logged in to Microsoft 365 and if so, with which account, use the <code>status</code> command.</p><p>If you&#x27;re logged in to Microsoft 365 using a certificate, the <code>status</code> command will show the name of the Azure AD application used to log in.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="log-out-from-microsoft-365">Log out from Microsoft 365<a class="hash-link" href="#log-out-from-microsoft-365" title="Direct link to heading">​</a></h3><p>To log out from Microsoft 365, use the <code>logout</code> command. Executing the <code>logout</code> command removes all connection information such as user name, refresh or access tokens stored on your computer.</p><script id="asciicast-445658" src="https://asciinema.org/a/445658.js" async=""></script><h3 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-sharepoint-online">Working with SharePoint Online<a class="hash-link" href="#working-with-sharepoint-online" title="Direct link to heading">​</a></h3><p>CLI for Microsoft 365 automatically detects the URL of your SharePoint Online tenant when executing SharePoint commands. All you need to do is to log in to Microsoft 365 with your account. Commands, that operate on specific site collections or sites, allow you to specify the URL of the site on which you want to perform the operation and you can execute them without having to specifically connect or login to the given site. CLI for Microsoft 365 will automatically retrieve the necessary access token to execute the given command.</p><p>!!! important
Some SharePoint commands in the CLI for Microsoft 365 require access to tenant-level resources. To execute these commands, you have to have permissions to access the tenant admin site.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="authorize-with-microsoft-365">Authorize with Microsoft 365<a class="hash-link" href="#authorize-with-microsoft-365" title="Direct link to heading">​</a></h2><p>To authorize for communicating with Microsoft 365 API, the CLI for Microsoft 365 uses the OAuth 2.0 protocol. When using the default device code flow, you authenticate with Azure AD in the web browser. After authenticating, CLI for Microsoft 365 will attempt to retrieve a valid access token for the specified Microsoft 365 service. If you have insufficient permissions to access the particular service, authorization will fail with an adequate error.</p><p>If you authenticate using credentials, the authentication and authorization are a part of the same request that CLI for Microsoft 365 issues towards Azure AD. If either authentication or authorization fails, you will see a corresponding error message explaining what went wrong.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="re-consent-the-pnp-microsoft-365-management-shell-azure-ad-application">Re-consent the PnP Microsoft 365 Management Shell Azure AD application<a class="hash-link" href="#re-consent-the-pnp-microsoft-365-management-shell-azure-ad-application" title="Direct link to heading">​</a></h2><p>CLI for Microsoft 365 uses the <em>PnP Microsoft 365 Management Shell</em> Azure AD application to log in to your Microsoft 365 tenant on your behalf. As we add new commands to the CLI, it&#x27;s possible, that new permissions will be added to the <em>PnP Microsoft 365 Management Shell</em> Azure AD application. To be able to use the newly added commands which depend on these new permissions, you will have to re-approve the <em>PnP Microsoft 365 Management Shell</em> Azure AD application in your Azure AD. This process is also known as <em>re-consenting the Azure AD application</em>.</p><p>To re-consent the <em>PnP Microsoft 365 Management Shell</em> application in your Azure AD, in the command line execute:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">m365 cli reconsent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CLI for Microsoft 365 will provide you with a URL that you should open in the web browser and sign in with your organizational account. After authenticating, Azure AD will prompt you to approve the new set of permissions. Once you approved the permissions, you will be redirected to an empty page. You can now use all commands in the CLI for Microsoft 365.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="logging-in-to-microsoft-365-via-a-proxy">Logging in to Microsoft 365 via a proxy<a class="hash-link" href="#logging-in-to-microsoft-365-via-a-proxy" title="Direct link to heading">​</a></h2><p>All communication between the CLI for Microsoft 365 and Microsoft 365 APIs happens via web requests. If you&#x27;re behind a proxy, you should set up an environment variable to allow CLI for Microsoft 365 to log in to Microsoft 365. More information about the necessary configuration steps is available at <a href="https://github.com/request/request#controlling-proxy-behaviour-using-environment-variables" target="_blank" rel="noopener noreferrer">https://github.com/request/request#controlling-proxy-behaviour-using-environment-variables</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="persisted-connections">Persisted connections<a class="hash-link" href="#persisted-connections" title="Direct link to heading">​</a></h2><p>After logging in to Microsoft 365, the CLI for Microsoft 365 will persist that connection information until you explicitly log out from Microsoft 365. This is necessary to support building scripts using the CLI for Microsoft 365, where each command is executed independently of other commands. Persisted connection contains information about the user name used to establish the connection as well as the retrieved refresh- and access tokens. To secure this information from unprivileged access, it&#x27;s stored securely in the password store specific to the platform on which you&#x27;re using the CLI. For more information, see the separate article dedicated to <a href="/cli-microsoft365-docusaurus/concepts/persisting-connection">persisting connection information</a> in the CLI for Microsoft 365.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/pnp/cli-microsoft365/blob/main/docs/docs/user-guide/connecting-office-365.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-04T10:44:38.000Z">Jan 4, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/cli-microsoft365-docusaurus/user-guide/run-cli-in-docker-container"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Run CLI in a Docker Container</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cli-microsoft365-docusaurus/user-guide/cli-output-mode"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CLI output mode</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#microsoft-365-services" class="table-of-contents__link toc-highlight">Microsoft 365 services</a><ul><li><a href="#log-in-to-microsoft-365-1" class="table-of-contents__link toc-highlight">Log in to Microsoft 365</a></li><li><a href="#check-login-status" class="table-of-contents__link toc-highlight">Check login status</a></li><li><a href="#log-out-from-microsoft-365" class="table-of-contents__link toc-highlight">Log out from Microsoft 365</a></li><li><a href="#working-with-sharepoint-online" class="table-of-contents__link toc-highlight">Working with SharePoint Online</a></li></ul></li><li><a href="#authorize-with-microsoft-365" class="table-of-contents__link toc-highlight">Authorize with Microsoft 365</a></li><li><a href="#re-consent-the-pnp-microsoft-365-management-shell-azure-ad-application" class="table-of-contents__link toc-highlight">Re-consent the PnP Microsoft 365 Management Shell Azure AD application</a></li><li><a href="#logging-in-to-microsoft-365-via-a-proxy" class="table-of-contents__link toc-highlight">Logging in to Microsoft 365 via a proxy</a></li><li><a href="#persisted-connections" class="table-of-contents__link toc-highlight">Persisted connections</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discordapp.com/invite/7rfW4kg6B5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/climicrosoft365" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/pnp/cli-microsoft365" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://aka.ms/sppnp-videos" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aka.ms/sppnp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Microsoft 365 &amp; Power Platform community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 CLI for Microsoft 365. Built with Docusaurus.</div></div></div></footer></div>
<script src="/cli-microsoft365-docusaurus/assets/js/runtime~main.4be4188f.js"></script>
<script src="/cli-microsoft365-docusaurus/assets/js/main.4e021339.js"></script>
</body>
</html>