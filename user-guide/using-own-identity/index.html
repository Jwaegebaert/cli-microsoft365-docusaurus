<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-user-guide/using-own-identity">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Use your own Azure AD identity - CLI for Microsoft 365</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/user-guide/using-own-identity"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Use your own Azure AD identity - CLI for Microsoft 365"><meta data-rh="true" name="description" content="When you use the CLI for Microsoft 365 to connect to your tenant for the first time, you are presented with a Permissions requested prompt from Azure, by accepting this prompt you are consenting to using the PnP Microsoft 365 Management Shell Azure AD application with your tenant as well as the permissions that it requires."><meta data-rh="true" property="og:description" content="When you use the CLI for Microsoft 365 to connect to your tenant for the first time, you are presented with a Permissions requested prompt from Azure, by accepting this prompt you are consenting to using the PnP Microsoft 365 Management Shell Azure AD application with your tenant as well as the permissions that it requires."><link data-rh="true" rel="icon" href="/cli-microsoft365-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/user-guide/using-own-identity"><link data-rh="true" rel="alternate" href="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/user-guide/using-own-identity" hreflang="en"><link data-rh="true" rel="alternate" href="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/user-guide/using-own-identity" hreflang="x-default"><link rel="stylesheet" href="/cli-microsoft365-docusaurus/assets/css/styles.d2de0e62.css">
<link rel="preload" href="/cli-microsoft365-docusaurus/assets/js/runtime~main.d76da4d2.js" as="script">
<link rel="preload" href="/cli-microsoft365-docusaurus/assets/js/main.23c468f8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cli-microsoft365-docusaurus/"><div class="navbar__logo"><img src="/cli-microsoft365-docusaurus/img/pnp-cli-microsoft365-white.svg" alt="CLI for Microsoft 365 Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cli-microsoft365-docusaurus/img/pnp-cli-microsoft365-white.svg" alt="CLI for Microsoft 365 Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cli-microsoft365-docusaurus/user-guide/installing-cli">User Guide</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/cmd/login">Commands</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/concepts/persisting-connection">Concepts</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/sample-scripts/aad/analyze-user-profile-photos/">Sample Scripts</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/about/why-cli">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/installing-cli">Install the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/using-cli">Use the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/run-cli-in-docker-container">Run CLI in a Docker Container</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/connecting-office-365">Log in to Microsoft 365</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/cli-output-mode">CLI output mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/filter-cli-data">Filter CLI data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/configuring-cli">Configure CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/completion">Command completion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/cli-microsoft365-docusaurus/user-guide/using-own-identity">Use your own Azure AD identity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/cli-certificate-caveats">Caveats when working with the CLI and certificate login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/github-actions">Automate your CI/CD workflow using CLI for Microsoft 365 GitHub Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/manage-microsoft-365-apps">Manage Microsoft 365 apps with the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/use-cli-api">Use CLI programmatically</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/user-guide/using-cli-context">Use CLI for Microsoft 365 context</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cli-microsoft365-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">User Guide</span><meta itemprop="position" content="1000"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Use your own Azure AD identity</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Use your own Azure AD identity</h1><p>When you use the CLI for Microsoft 365 to connect to your tenant for the first time, you are presented with a <code>Permissions requested</code> prompt from Azure, by accepting this prompt you are consenting to using the <code>PnP Microsoft 365 Management Shell</code> Azure AD application with your tenant as well as the permissions that it requires.</p><p>We ask for a wide range to permissions upfront, including permissions that require administrative level consent, so that it is easy to get started with the CLI and try out the commands across many CLI for Microsoft 365 workloads in your tenant without having to handle the complexity of managing the permissions for the different commands manually in Azure.</p><p>Whilst this is fine for working against development and test environments, using these levels of permissions against production environments is inconvenient and administrators are not comfortable with granting such permissions to a multi-tenant application within their environment.</p><p>In this scenario, administrators will want to provide their own Azure AD app registration to use with the CLI to enable greater control over the permissions that are granted.</p><p>This tutorial will walk you through how to create your own Azure AD application with permissions restricted to only read information about SharePoint Online Site Collections and how to use this custom application with the CLI for Microsoft 365.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="register-azure-ad-application-in-your-tenant">Register Azure AD application in your tenant<a href="#register-azure-ad-application-in-your-tenant" class="hash-link" aria-label="Direct link to Register Azure AD application in your tenant" title="Direct link to Register Azure AD application in your tenant">​</a></h2><p>We first need to register a new Azure AD application in your tenant, to do this we will need to navigate to the <a href="https://portal.azure.com" target="_blank" rel="noopener noreferrer">Azure Portal</a>.</p><p>Select <code>Azure Active Directory</code> from the global menu, select <code>App registrations</code> in the Azure Active Directory blade and then select the <code>New registration</code> action button to open the <code>Register an application</code> form.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/new-app-registration-39c18b117002dac8d3dae5fd7bd42ea1.png"><img loading="lazy" alt="New app registration" src="/cli-microsoft365-docusaurus/assets/images/new-app-registration-39c18b117002dac8d3dae5fd7bd42ea1.png" width="2290" height="1256" class="img_ev3q"></a></p><p>In the form, enter a name for your new application, for the purpose of this tutorial let&#x27;s use <code>Custom PnP CLI for Microsoft 365</code>. You can always change this later if you want. Leave the <code>Supported account types</code> and <code>Redirect URI</code> values as they are and select the <code>Register</code> button at the foot of the form to create your custom application.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/register-an-application-eccfcb3cf4fafe0abf469d853ec886fb.png"><img loading="lazy" alt="Register an application" src="/cli-microsoft365-docusaurus/assets/images/register-an-application-eccfcb3cf4fafe0abf469d853ec886fb.png" width="2290" height="1218" class="img_ev3q"></a></p><p>After the application has been created, you will be presented with the blade for your application displaying an overview of some properties of the application. At this point it is a good idea to take note of two key pieces of information that we will need later.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/client-and-tenantid-be27ed2b223a435dd75013872a1d98c8.png"><img loading="lazy" alt="Client and Tenant ID" src="/cli-microsoft365-docusaurus/assets/images/client-and-tenantid-be27ed2b223a435dd75013872a1d98c8.png" width="2290" height="908" class="img_ev3q"></a></p><p>Take a copy of both the <code>Application (client) ID</code> and <code>Directory (tenant) ID</code> values and save them to a place for you to refer back to them later.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-authentication-settings">Configure Authentication settings<a href="#configure-authentication-settings" class="hash-link" aria-label="Direct link to Configure Authentication settings" title="Direct link to Configure Authentication settings">​</a></h2><p>We next need to configure our new application so that it can be used with the CLI for Microsoft 365. To do this we need to select <code>Authentication</code> in the <code>Custom PnP CLI for Microsoft 365</code> blade menu.</p><p>This will present you with three sections: <code>Platform configuration</code>, <code>Supported account type</code> and <code>Advanced settings</code>.</p><p>Select the <code>Add a platform</code> button to open up the <code>Configure platforms</code> menu and under the <code>Mobile and desktop applications</code> heading, select <code>Mobile and desktop applications</code>. This will open another menu called <code>Configure Desktop + Devices</code> displaying a section called <code>Redirect URIs</code> and a list of checkboxes with some pre-defined URIs.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/configure-platforms-51b0ef00b86bce2ee7450f7c77afee98.png"><img loading="lazy" alt="Configure platforms" src="/cli-microsoft365-docusaurus/assets/images/configure-platforms-51b0ef00b86bce2ee7450f7c77afee98.png" width="2290" height="1108" class="img_ev3q"></a></p><p>Select the first option in the list, <code>https://login.microsoftonline.com/common/oauth2/nativeclient</code> and select the <code>Configure</code> button at the foot of the menu.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/configure-desktop-and-devices-2e7d300cd71286fb7e01b5b4609ff704.png"><img loading="lazy" alt="Configure Desktop + Devices" src="/cli-microsoft365-docusaurus/assets/images/configure-desktop-and-devices-2e7d300cd71286fb7e01b5b4609ff704.png" width="2290" height="1200" class="img_ev3q"></a></p><p>This will refresh the <code>Authentication</code> blade and will display the Redirect URI we just chose from the menu.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/mobile-and-desktop-applications-30810233928b69a845f42189db144fea.png"><img loading="lazy" alt="Mobile and desktop applications" src="/cli-microsoft365-docusaurus/assets/images/mobile-and-desktop-applications-30810233928b69a845f42189db144fea.png" width="2292" height="1336" class="img_ev3q"></a></p><p>!!! info
This Redirect URI is specific to the use of authentication methods that do not use a web interface for authenticating users and are therefore called <code>Native Clients</code>. This is the category that the CLI for Microsoft 365 falls into.</p><p>Moving on, we can skip over the <code>Supported account type</code> section, as this is defaulted to <code>Accounts in this organizational directory only (&lt;tenant&gt; only - Single tenant)</code> meaning, that only users within the current tenant directory can use this application. In the <code>Advanced settings</code> section, we need to enable the <code>Allow public client flows</code> toggle, as we are using the <code>Device code flow</code> method to authenticate to our tenant using the CLI for Microsoft 365.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/advanced-settings-e37b329e9ec0eb1dd345e88f3c0eac3b.png"><img loading="lazy" alt="Advanced settings" src="/cli-microsoft365-docusaurus/assets/images/advanced-settings-e37b329e9ec0eb1dd345e88f3c0eac3b.png" width="1073" height="465" class="img_ev3q"></a></p><p>To make sure all these changes are applied, select the <code>Save</code> button before moving on.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-api-permissions">Configure API Permissions<a href="#configure-api-permissions" class="hash-link" aria-label="Direct link to Configure API Permissions" title="Direct link to Configure API Permissions">​</a></h2><p>Now that we have configured the application to work with the CLI for Microsoft 365, we next need to grant what permissions the CLI will have within our tenant. Select the <code>API permissions</code> in the <code>Custom PnP CLI for Microsoft 365</code> blade menu.</p><p>You will see a section called <code>Configured permissions</code> with one permission already granted. This is the default permission which allows the application to sign in the user account used when authenticating to the Microsoft Graph.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/configured-permissions-9808de000950dedd6e4fb045d932ba39.png"><img loading="lazy" alt="Configured permissions" src="/cli-microsoft365-docusaurus/assets/images/configured-permissions-9808de000950dedd6e4fb045d932ba39.png" width="2290" height="1200" class="img_ev3q"></a></p><p>Select the <code>Add a permission</code> button to open the <code>Request API permissions</code> menu. As we are only interested in granting our application access to SharePoint Online for the purpose of this tutorial, select <code>SharePoint</code> in the list of APIs that are available.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/request-api-permissions-008113ae5443c78bf222e14aa553ca81.png"><img loading="lazy" alt="Request API permissions" src="/cli-microsoft365-docusaurus/assets/images/request-api-permissions-008113ae5443c78bf222e14aa553ca81.png" width="2292" height="1640" class="img_ev3q"></a></p><p>This opens the menu with two options: <code>Delegated permissions</code> or <code>Application permissions</code>. As we are going to be communicating with the SharePoint Online APIs as the authenticated user, select <code>Delegated permissions</code>. This will display a list of available permissions that we can choose from.</p><p>For the purpose of this tutorial we only want to grant read access to SharePoint Online, so expand the <code>AllSites</code> grouping and select the <code>AllSites.Read</code> permission. Next, select the <code>Add permissions</code> button to apply these permissions.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/spo-delegated-permissions-558013fa91f3a03402d53b59c417cdef.png"><img loading="lazy" alt="SharePoint Online Delegated permissions" src="/cli-microsoft365-docusaurus/assets/images/spo-delegated-permissions-558013fa91f3a03402d53b59c417cdef.png" width="2290" height="1716" class="img_ev3q"></a></p><p>!!! attention
Note that the <code>AllSites.Read</code> permission does not directly grant the signed-in user access to all sites in SharePoint Online. As we authenticate as the signed-in user, that user must still have access to the SharePoint sites that we want to return information about, otherwise the SharePoint Online API calls will fail with a <code>401 Unauthorized</code> error.</p><p>You will be presented with the <code>Configured permissions</code> section again but this time the <code>AllSites.Read</code> permission will be shown under the <code>SharePoint</code> grouping.</p><p><a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/spo-configured-permissions-2c107499a3f1081735ae980b9141ba19.png"><img loading="lazy" alt="SharePoint Online Configured permissions" src="/cli-microsoft365-docusaurus/assets/images/spo-configured-permissions-2c107499a3f1081735ae980b9141ba19.png" width="2290" height="1198" class="img_ev3q"></a></p><p>!!! attention
Note that when executing tenant level SharePoint Online commands, the CLI will attempt to autodiscover your tenant URL.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">It will first check for the presence of an environment variable containing the tenant URL, which can be set by using [`m365 spo set`](../../cmd/spo/spo-set/) command.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">If this cannot be found, a request will be made to the Microsoft Graph. For this request to be successful, you must ensure that you have at least the `Sites.Read.All` permission granted to your application.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This completes the configuration required in the Azure portal. We can now move onto configuring the CLI for Microsoft 365 to use our custom application to login to Microsoft 365.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-environment-variables">Create environment variables<a href="#create-environment-variables" class="hash-link" aria-label="Direct link to Create environment variables" title="Direct link to Create environment variables">​</a></h2><p>To configure the CLI for Microsoft 365 to use our newly created custom application, we need to tell it the Client ID of our custom application and the Tenant ID of where the custom application has been created.</p><p>To do that, we need to create two environment variables, named <code>CLIMICROSOFT365_AADAPPID</code> and <code>CLIMICROSOFT365_TENANT</code>, giving them the values that you saved earlier.</p><p>How you set the environment variables depends on the operating system and shell that you are using.</p><p>If you are on Windows, you can set the environment variables using the <code>$env:&lt;variable-name&gt;</code> approach in a PowerShell session.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">$env:CLIMICROSOFT365_AADAPPID=&quot;506af689-32aa-46c8-afb5-972ebf9d218a&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">$env:CLIMICROSOFT365_TENANT=&quot;e8954f17-a373-4b61-b54d-45c038fe3188&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>!!! tip
Execute <code>$env:CLIMICROSOFT365_AADAPPID</code> and <code>$env:CLIMICROSOFT365_TENANT</code> to verify that the environment variables have been created correctly</p><p>If you are using Linux or macOS, you can set the environment variables using the <code>export</code> command from your terminal prompt.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">export CLIMICROSOFT365_AADAPPID=506af689-32aa-46c8-afb5-972ebf9d218a</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">export CLIMICROSOFT365_TENANT=e8954f17-a373-4b61-b54d-45c038fe3188</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>!!! tip
Execute <code>printenv</code> to verify that the environment variables have been created correctly</p><p>Now that we have set our environment variables, we are now ready to use our custom application to log in with using the CLI for Microsoft 365.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="login-and-consent">Login and consent<a href="#login-and-consent" class="hash-link" aria-label="Direct link to Login and consent" title="Direct link to Login and consent">​</a></h2><p>For the purpose of this tutorial, we will be using the <code>Device code flow</code> to interactively authenticate with an Microsoft 365 tenant. As this is the first time that we will have used the custom application to authenticate, we will also be required to give our consent.</p><p>At your terminal session, execute <code>m365 login</code> to start the authentication process, a login device code will be displayed along with a link to a web page where it needs to be entered. Navigate to <a href="https://microsoft.com/devicelogin" target="_blank" rel="noopener noreferrer">https://microsoft.com/devicelogin</a>, enter the code into the input field and select <code>Next</code>. You will then be presented with either a login screen or accounts that you have already logged in to Microsoft 365 with. Login with or choose the account from the list that you want to use with CLI for Microsoft 365.</p><p>You will now be prompted to consent that the custom application, <code>Custom PnP CLI for Microsoft 365</code>, can use the two permissions that we configure earlier, <code>Read items in all site collections</code> and <code>Sign you in and read your profile</code> on your behalf. Select <code>Accept</code> to consent and complete the sign-in process.</p><p>Returning back to your command line, you can now verify that the sign in has been successful by executing the <code>m365 status</code> command.</p><p>Finally, to test that we can indeed read SharePoint Online site collections, let&#x27;s invoke the following command</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">m365 spo site get --url https://contoso.sharepoint.com -o json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The JSON representation of the SharePoint Online site will be returned to the console.</p><p>Congratulations! You have just configured the CLI for Microsoft 365 to use your own custom application with custom permissions from your own Azure Active Directory.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="persisting-environment-variables">Persisting environment variables<a href="#persisting-environment-variables" class="hash-link" aria-label="Direct link to Persisting environment variables" title="Direct link to Persisting environment variables">​</a></h2><p>As mentioned earlier, the way in which we set the environment variables meant that they are only set for the lifetime of the session, if the terminal session is closed, you will need to repeat those steps, which may be undesirable.</p><p>How you permanently set the environment variable is dependant on the operating system and shell you are using.</p><p>If you are on Windows, you can set the environment variables using the <code>Edit the system environment variables</code> approach in the Windows UI.</p><p>Search for <code>Edit the system environment variables</code> in Start Menu and launch it. Select <code>Environment Variables</code>, under the <code>User variables for &lt;user-name&gt;</code> section, select <code>New...</code> to add a new variable. In the dialog, in the variable name field enter <code>CLIMICROSOFT365_AADAPPID</code> and set the value using the Client ID (quotes should be omitted). Select <code>OK</code> to save the value and repeat the process for the <code>CLIMICROSOFT365_TENANT</code> variable. Select <code>OK</code> until all windows are closed to persist the changes.</p><p>Open a new PowerShell session and execute <code>$env:CLIMICROSOFT365_AADAPPID</code> and <code>$env:CLIMICROSOFT365_TENANT</code> to verify that the environment variables have been created correctly.</p><p>If you are on Linux or MacOS, depending on your terminal, add the  <code>export</code> lines to <code>.bashrc</code> or <code>.zshrc</code> file in your home directory.</p><p>If you are using PowerShell, it is worth noting that environment variables set in <code>bash</code> or <code>zsh</code> will persist to the <code>pwsh</code> session and the same applies to Windows.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/pnp/cli-microsoft365/blob/main/docs/docs/user-guide/using-own-identity.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-04-10T16:37:53.000Z">Apr 10, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/cli-microsoft365-docusaurus/user-guide/completion"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Command completion</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cli-microsoft365-docusaurus/user-guide/cli-certificate-caveats"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Caveats when working with the CLI and certificate login</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#register-azure-ad-application-in-your-tenant" class="table-of-contents__link toc-highlight">Register Azure AD application in your tenant</a></li><li><a href="#configure-authentication-settings" class="table-of-contents__link toc-highlight">Configure Authentication settings</a></li><li><a href="#configure-api-permissions" class="table-of-contents__link toc-highlight">Configure API Permissions</a></li><li><a href="#create-environment-variables" class="table-of-contents__link toc-highlight">Create environment variables</a></li><li><a href="#login-and-consent" class="table-of-contents__link toc-highlight">Login and consent</a></li><li><a href="#persisting-environment-variables" class="table-of-contents__link toc-highlight">Persisting environment variables</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footerContainer_Q_7E"><p class="footerPromo_nJOm">Built with <a href="https://docusaurus.io/" target="_blank" rel="noopener" title="Docusaurus.io">Docusaurus</a></p><div class="footerIcons_IFG5"><a href="https://github.com/pnp/cli-microsoft365" target="_blank" rel="noopener" title="github.com"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://aka.ms/cli-m365/discord" target="_blank" rel="noopener" title="aka.ms/cli-m365/discord"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"></path></svg></a><a href="https://twitter.com/climicrosoft365" target="_blank" rel="noopener" title="twitter.com"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="http://aka.ms/sppnp-videos" target="_blank" rel="noopener" title="aka.ms/sppnp-videos"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a><a href="https://aka.ms/sppnp" target="_blank" rel="noopener" title="aka.ms/sppnp"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6 31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0l112.3-112.3zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5 50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5l112.2-112.3c31.5-31.5 82.5-31.5 114 0 27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div></div></div></footer></div>
<script src="/cli-microsoft365-docusaurus/assets/js/runtime~main.d76da4d2.js"></script>
<script src="/cli-microsoft365-docusaurus/assets/js/main.23c468f8.js"></script>
</body>
</html>