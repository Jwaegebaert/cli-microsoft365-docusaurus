<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-concepts/authorization-tokens">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Authorization and access tokens - CLI for Microsoft 365</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/concepts/authorization-tokens"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Authorization and access tokens - CLI for Microsoft 365"><meta data-rh="true" name="description" content="Commands provided with the CLI for Microsoft 365 manipulate different settings of Microsoft 365. Before you can execute any of the commands in the CLI, you have to log in to Microsoft 365. CLI for Microsoft 365 will then automatically retrieve the access token necessary to execute the particular command."><meta data-rh="true" property="og:description" content="Commands provided with the CLI for Microsoft 365 manipulate different settings of Microsoft 365. Before you can execute any of the commands in the CLI, you have to log in to Microsoft 365. CLI for Microsoft 365 will then automatically retrieve the access token necessary to execute the particular command."><link data-rh="true" rel="icon" href="/cli-microsoft365-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/concepts/authorization-tokens"><link data-rh="true" rel="alternate" href="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/concepts/authorization-tokens" hreflang="en"><link data-rh="true" rel="alternate" href="https://jwaegebaert.github.io/cli-microsoft365-docusaurus/concepts/authorization-tokens" hreflang="x-default"><link rel="stylesheet" href="/cli-microsoft365-docusaurus/assets/css/styles.e442f660.css">
<link rel="preload" href="/cli-microsoft365-docusaurus/assets/js/runtime~main.169a8eff.js" as="script">
<link rel="preload" href="/cli-microsoft365-docusaurus/assets/js/main.048ba644.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cli-microsoft365-docusaurus/"><div class="navbar__logo"><img src="/cli-microsoft365-docusaurus/img/pnp-cli-microsoft365-white.svg" alt="CLI for Microsoft 365 Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cli-microsoft365-docusaurus/img/pnp-cli-microsoft365-white.svg" alt="CLI for Microsoft 365 Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/">Home</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/user-guide/installing-cli">User Guide</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/cmd/login">Commands</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cli-microsoft365-docusaurus/concepts/persisting-connection">Concepts</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/sample-scripts/aad/analyze-user-profile-photos/">Sample Scripts</a><a class="navbar__item navbar__link" href="/cli-microsoft365-docusaurus/about/why-cli">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/concepts/persisting-connection">Persisting connection information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/cli-microsoft365-docusaurus/concepts/authorization-tokens">Authorization and access tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cli-microsoft365-docusaurus/concepts/communicating-m365">Communication with Microsoft 365</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cli-microsoft365-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1000"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Authorization and access tokens</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Authorization and access tokens</h1><p>Commands provided with the CLI for Microsoft 365 manipulate different settings of Microsoft 365. Before you can execute any of the commands in the CLI, you have to log in to Microsoft 365. CLI for Microsoft 365 will then automatically retrieve the access token necessary to execute the particular command.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="authorization-in-the-cli-for-microsoft-365">Authorization in the CLI for Microsoft 365<a href="#authorization-in-the-cli-for-microsoft-365" class="hash-link" aria-label="Direct link to Authorization in the CLI for Microsoft 365" title="Direct link to Authorization in the CLI for Microsoft 365">​</a></h2><p>There are a number of ways in which you can authenticate and authorize with Microsoft 365. The CLI for Microsoft 365 uses the OAuth protocol to authorize with Microsoft 365 and its services. OAuth flows in Microsoft 365 are facilitated by Azure Active Directory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="azure-ad-application-used-by-the-cli-for-microsoft-365">Azure AD application used by the CLI for Microsoft 365<a href="#azure-ad-application-used-by-the-cli-for-microsoft-365" class="hash-link" aria-label="Direct link to Azure AD application used by the CLI for Microsoft 365" title="Direct link to Azure AD application used by the CLI for Microsoft 365">​</a></h3><p>CLI for Microsoft 365 gets access to Microsoft 365 through a custom Azure AD application named <em>PnP Microsoft 365 Management Shell</em>. If you don&#x27;t want to consent this application in your tenant, you can use a different application instead.</p><p>!!! important
When you decide to use your own Azure AD application, you need to choose the application to be a <strong>public client</strong>. Despite the setting&#x27;s description, the application will not be publicly accessible. This setting enables the use of the device flow for your own application. Without activating this setting, it is not possible to complete the authentication process. The option is currently only available in the preview blade for managing for Azure AD applications.
<a target="_blank" href="/cli-microsoft365-docusaurus/assets/files/activate-public-client-aad-app-364b1115880c69d1be8b967b4fd14732.png"><img loading="lazy" alt="The &amp;#39;public client&amp;#39; enabled for an Azure AD application" src="/cli-microsoft365-docusaurus/assets/images/activate-public-client-aad-app-364b1115880c69d1be8b967b4fd14732.png" width="1456" height="412" class="img_ev3q"></a></p><p>When specifying a custom Azure AD application to be used by the CLI for Microsoft 365, set the <code>CLIMICROSOFT365_AADAPPID</code> environment variable to the ID of your Azure AD application.</p><p>CLI for Microsoft 365 requires the following permissions to Microsoft 365 services:</p><ul><li>Microsoft 365 SharePoint Online<ul><li>Have full control of all site collections</li><li>Read user profiles</li><li>Read and write managed metadata</li></ul></li><li>Microsoft Graph<ul><li>Read and write to all app catalogs</li><li>Read and write all groups</li><li>Read and write directory data</li><li>Access directory as the signed in user</li><li>Read and write identity providers</li><li>Read and write access to user mail</li><li>Send mail as a user</li><li>Read all usage reports</li><li>Manage user&#x27;s installed Teams apps</li><li>Invite guest users to the organization</li><li>Create, read, update and delete user tasks and projects</li></ul></li><li>Microsoft 365 Management APIs<ul><li>Read service health information for your organization</li></ul></li><li>Windows Azure Active Directory<ul><li>Access the directory as the signed-in user</li></ul></li><li>Windows Azure Service Management API<ul><li>Access Azure Service Management as organization users</li></ul></li><li>Yammer<ul><li>Read and write to the Yammer platform</li></ul></li></ul><p>!!! attention
After changing the ID of the Azure AD application used by the CLI for Microsoft 365 refresh the existing connection to Microsoft 365 using the <code>login</code> command. If you try to use the existing connection, CLI for Microsoft 365 will fail when trying to refresh the existing access token.</p><p>For instructions on how to create your own Azure AD app see <a href="/cli-microsoft365-docusaurus/user-guide/using-own-identity">Using your own Azure AD identity</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-and-refresh-tokens-in-the-cli-for-microsoft-365">Access and refresh tokens in the CLI for Microsoft 365<a href="#access-and-refresh-tokens-in-the-cli-for-microsoft-365" class="hash-link" aria-label="Direct link to Access and refresh tokens in the CLI for Microsoft 365" title="Direct link to Access and refresh tokens in the CLI for Microsoft 365">​</a></h3><p>After completing the OAuth flow, the CLI receives from Azure Active Directory a refresh- and an access token. Each web request to Microsoft 365 APIs contains the access token which authorizes the CLI for Microsoft 365 to execute the particular operation. When the access token expires, the CLI uses the refresh token to obtain a new access token. When the refresh token expires, the user has to reauthenticate to Microsoft 365 to obtain a new refresh token.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="services-and-commands">Services and commands<a href="#services-and-commands" class="hash-link" aria-label="Direct link to Services and commands" title="Direct link to Services and commands">​</a></h2><p>Each command in the CLI for Microsoft 365 belongs to a service, for example the <a href="/cli-microsoft365-docusaurus/cmd/spo/site/site-add">spo site add</a> command, which creates a new modern site, belongs to the SharePoint Online service, while the <a href="/cli-microsoft365-docusaurus/cmd/aad/sp/sp-get">aad sp get</a> command, which lists Azure Active Directory service principals, belongs to the Azure Active Directory Graph service. Each service in Microsoft 365 is a different Azure Active Directory authorization resource and requires a separate access token. When working with the CLI, you can be simultaneously connected to multiple services. Each command in the CLI knows which Microsoft 365 service it communicates with and for which resource it should have a valid access token.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="communicating-with-microsoft-365">Communicating with Microsoft 365<a href="#communicating-with-microsoft-365" class="hash-link" aria-label="Direct link to Communicating with Microsoft 365" title="Direct link to Communicating with Microsoft 365">​</a></h2><p>Before a command can log in to Microsoft 365, it requires a valid access token. CLI for Microsoft 365 automatically obtains the access token for the particular web request without you having to worry about it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="yammer-commands-are-executed-in-the-context-of-the-current-logged-in-user">Yammer commands are executed in the context of the current logged in user<a href="#yammer-commands-are-executed-in-the-context-of-the-current-logged-in-user" class="hash-link" aria-label="Direct link to Yammer commands are executed in the context of the current logged in user" title="Direct link to Yammer commands are executed in the context of the current logged in user">​</a></h2><p>Yammer commands require the delegated &#x27;user_impersonation&#x27; permission to be granted for the Azure AD application. Yammer commands are executed in the context of the currently logged in user. Certificate-based authentication with app_only permissions is currently not supported by Azure AD.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/pnp/cli-microsoft365/blob/main/docs/docs/concepts/authorization-tokens.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-02-09T18:58:51.000Z">Feb 9, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/cli-microsoft365-docusaurus/concepts/persisting-connection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Persisting connection information</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cli-microsoft365-docusaurus/concepts/communicating-m365"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Communication with Microsoft 365</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#authorization-in-the-cli-for-microsoft-365" class="table-of-contents__link toc-highlight">Authorization in the CLI for Microsoft 365</a><ul><li><a href="#azure-ad-application-used-by-the-cli-for-microsoft-365" class="table-of-contents__link toc-highlight">Azure AD application used by the CLI for Microsoft 365</a></li><li><a href="#access-and-refresh-tokens-in-the-cli-for-microsoft-365" class="table-of-contents__link toc-highlight">Access and refresh tokens in the CLI for Microsoft 365</a></li></ul></li><li><a href="#services-and-commands" class="table-of-contents__link toc-highlight">Services and commands</a></li><li><a href="#communicating-with-microsoft-365" class="table-of-contents__link toc-highlight">Communicating with Microsoft 365</a></li><li><a href="#yammer-commands-are-executed-in-the-context-of-the-current-logged-in-user" class="table-of-contents__link toc-highlight">Yammer commands are executed in the context of the current logged in user</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discordapp.com/invite/7rfW4kg6B5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/climicrosoft365" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/pnp/cli-microsoft365" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://aka.ms/sppnp-videos" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aka.ms/sppnp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Microsoft 365 &amp; Power Platform community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 CLI for Microsoft 365. Built with Docusaurus.</div></div></div></footer></div>
<script src="/cli-microsoft365-docusaurus/assets/js/runtime~main.169a8eff.js"></script>
<script src="/cli-microsoft365-docusaurus/assets/js/main.048ba644.js"></script>
</body>
</html>