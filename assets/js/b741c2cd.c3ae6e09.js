"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[68955],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>d});var r=o(67294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function c(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var s=r.createContext({}),l=function(e){var t=r.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),p=l(o),h=n,d=p["".concat(s,".").concat(h)]||p[h]||m[h]||i;return o?r.createElement(d,a(a({ref:t},u),{},{components:o})):r.createElement(d,a({ref:t},u))}));function d(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=o.length,a=new Array(i);a[0]=h;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[p]="string"==typeof e?e:n,a[1]=c;for(var l=2;l<i;l++)a[l]=o[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,o)}h.displayName="MDXCreateElement"},47452:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var r=o(87462),n=(o(67294),o(3905));const i={},a="Authorization and access tokens",c={unversionedId:"concepts/authorization-tokens",id:"concepts/authorization-tokens",title:"Authorization and access tokens",description:"Commands provided with the CLI for Microsoft 365 manipulate different settings of Microsoft 365. Before you can execute any of the commands in the CLI, you have to log in to Microsoft 365. CLI for Microsoft 365 will then automatically retrieve the access token necessary to execute the particular command.",source:"@site/docs/concepts/authorization-tokens.md",sourceDirName:"concepts",slug:"/concepts/authorization-tokens",permalink:"/cli-microsoft365-docusaurus/concepts/authorization-tokens",draft:!1,editUrl:"https://github.com/pnp/cli-microsoft365/blob/main/docs/docs/concepts/authorization-tokens.md",tags:[],version:"current",lastUpdatedAt:1672930100,formattedLastUpdatedAt:"Jan 5, 2023",frontMatter:{},sidebar:"concepts",previous:{title:"Persisting connection information",permalink:"/cli-microsoft365-docusaurus/concepts/persisting-connection"},next:{title:"Communication with Microsoft 365",permalink:"/cli-microsoft365-docusaurus/concepts/communicating-m365"}},s={},l=[{value:"Authorization in the CLI for Microsoft 365",id:"authorization-in-the-cli-for-microsoft-365",level:2},{value:"Azure AD application used by the CLI for Microsoft 365",id:"azure-ad-application-used-by-the-cli-for-microsoft-365",level:3},{value:"Access and refresh tokens in the CLI for Microsoft 365",id:"access-and-refresh-tokens-in-the-cli-for-microsoft-365",level:3},{value:"Services and commands",id:"services-and-commands",level:2},{value:"Communicating with Microsoft 365",id:"communicating-with-microsoft-365",level:2},{value:"Yammer commands are executed in the context of the current logged in user",id:"yammer-commands-are-executed-in-the-context-of-the-current-logged-in-user",level:2}],u={toc:l};function p(e){let{components:t,...i}=e;return(0,n.kt)("wrapper",(0,r.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"authorization-and-access-tokens"},"Authorization and access tokens"),(0,n.kt)("p",null,"Commands provided with the CLI for Microsoft 365 manipulate different settings of Microsoft 365. Before you can execute any of the commands in the CLI, you have to log in to Microsoft 365. CLI for Microsoft 365 will then automatically retrieve the access token necessary to execute the particular command."),(0,n.kt)("h2",{id:"authorization-in-the-cli-for-microsoft-365"},"Authorization in the CLI for Microsoft 365"),(0,n.kt)("p",null,"There are a number of ways in which you can authenticate and authorize with Microsoft 365. The CLI for Microsoft 365 uses the OAuth protocol to authorize with Microsoft 365 and its services. OAuth flows in Microsoft 365 are facilitated by Azure Active Directory."),(0,n.kt)("h3",{id:"azure-ad-application-used-by-the-cli-for-microsoft-365"},"Azure AD application used by the CLI for Microsoft 365"),(0,n.kt)("p",null,"CLI for Microsoft 365 gets access to Microsoft 365 through a custom Azure AD application named ",(0,n.kt)("em",{parentName:"p"},"PnP Microsoft 365 Management Shell"),". If you don't want to consent this application in your tenant, you can use a different application instead."),(0,n.kt)("p",null,"!!! important\nWhen you decide to use your own Azure AD application, you need to choose the application to be a ",(0,n.kt)("strong",{parentName:"p"},"public client"),". Despite the setting's description, the application will not be publicly accessible. This setting enables the use of the device flow for your own application. Without activating this setting, it is not possible to complete the authentication process. The option is currently only available in the preview blade for managing for Azure AD applications.\n",(0,n.kt)("a",{target:"_blank",href:o(77733).Z},(0,n.kt)("img",{alt:"The &#39;public client&#39; enabled for an Azure AD application",src:o(89413).Z,width:"1456",height:"412"}))),(0,n.kt)("p",null,"When specifying a custom Azure AD application to be used by the CLI for Microsoft 365, set the ",(0,n.kt)("inlineCode",{parentName:"p"},"CLIMICROSOFT365_AADAPPID")," environment variable to the ID of your Azure AD application."),(0,n.kt)("p",null,"CLI for Microsoft 365 requires the following permissions to Microsoft 365 services:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Microsoft 365 SharePoint Online",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Have full control of all site collections"),(0,n.kt)("li",{parentName:"ul"},"Read user profiles"),(0,n.kt)("li",{parentName:"ul"},"Read and write managed metadata"))),(0,n.kt)("li",{parentName:"ul"},"Microsoft Graph",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Read and write to all app catalogs"),(0,n.kt)("li",{parentName:"ul"},"Read and write all groups"),(0,n.kt)("li",{parentName:"ul"},"Read and write directory data"),(0,n.kt)("li",{parentName:"ul"},"Access directory as the signed in user"),(0,n.kt)("li",{parentName:"ul"},"Read and write identity providers"),(0,n.kt)("li",{parentName:"ul"},"Read and write access to user mail"),(0,n.kt)("li",{parentName:"ul"},"Send mail as a user"),(0,n.kt)("li",{parentName:"ul"},"Read all usage reports"),(0,n.kt)("li",{parentName:"ul"},"Manage user's installed Teams apps"),(0,n.kt)("li",{parentName:"ul"},"Invite guest users to the organization"),(0,n.kt)("li",{parentName:"ul"},"Create, read, update and delete user tasks and projects"))),(0,n.kt)("li",{parentName:"ul"},"Microsoft 365 Management APIs",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Read service health information for your organization"))),(0,n.kt)("li",{parentName:"ul"},"Windows Azure Active Directory",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Access the directory as the signed-in user"))),(0,n.kt)("li",{parentName:"ul"},"Windows Azure Service Management API",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Access Azure Service Management as organization users"))),(0,n.kt)("li",{parentName:"ul"},"Yammer",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Read and write to the Yammer platform")))),(0,n.kt)("p",null,"!!! attention\nAfter changing the ID of the Azure AD application used by the CLI for Microsoft 365 refresh the existing connection to Microsoft 365 using the ",(0,n.kt)("inlineCode",{parentName:"p"},"login")," command. If you try to use the existing connection, CLI for Microsoft 365 will fail when trying to refresh the existing access token."),(0,n.kt)("p",null,"For instructions on how to create your own Azure AD app see ",(0,n.kt)("a",{parentName:"p",href:"/cli-microsoft365-docusaurus/user-guide/using-own-identity"},"Using your own Azure AD identity"),"."),(0,n.kt)("h3",{id:"access-and-refresh-tokens-in-the-cli-for-microsoft-365"},"Access and refresh tokens in the CLI for Microsoft 365"),(0,n.kt)("p",null,"After completing the OAuth flow, the CLI receives from Azure Active Directory a refresh- and an access token. Each web request to Microsoft 365 APIs contains the access token which authorizes the CLI for Microsoft 365 to execute the particular operation. When the access token expires, the CLI uses the refresh token to obtain a new access token. When the refresh token expires, the user has to reauthenticate to Microsoft 365 to obtain a new refresh token."),(0,n.kt)("h2",{id:"services-and-commands"},"Services and commands"),(0,n.kt)("p",null,"Each command in the CLI for Microsoft 365 belongs to a service, for example the ",(0,n.kt)("a",{parentName:"p",href:"/cli-microsoft365-docusaurus/cmd/spo/site/site-add"},"spo site add")," command, which creates a new modern site, belongs to the SharePoint Online service, while the ",(0,n.kt)("a",{parentName:"p",href:"/cli-microsoft365-docusaurus/cmd/aad/sp/sp-get"},"aad sp get")," command, which lists Azure Active Directory service principals, belongs to the Azure Active Directory Graph service. Each service in Microsoft 365 is a different Azure Active Directory authorization resource and requires a separate access token. When working with the CLI, you can be simultaneously connected to multiple services. Each command in the CLI knows which Microsoft 365 service it communicates with and for which resource it should have a valid access token."),(0,n.kt)("h2",{id:"communicating-with-microsoft-365"},"Communicating with Microsoft 365"),(0,n.kt)("p",null,"Before a command can log in to Microsoft 365, it requires a valid access token. CLI for Microsoft 365 automatically obtains the access token for the particular web request without you having to worry about it."),(0,n.kt)("h2",{id:"yammer-commands-are-executed-in-the-context-of-the-current-logged-in-user"},"Yammer commands are executed in the context of the current logged in user"),(0,n.kt)("p",null,"Yammer commands require the delegated 'user_impersonation' permission to be granted for the Azure AD application. Yammer commands are executed in the context of the currently logged in user. Certificate-based authentication with app_only permissions is currently not supported by Azure AD."))}p.isMDXComponent=!0},77733:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/files/activate-public-client-aad-app-364b1115880c69d1be8b967b4fd14732.png"},89413:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/activate-public-client-aad-app-364b1115880c69d1be8b967b4fd14732.png"}}]);