"use strict";(self.webpackChunkcli_for_microsoft_365_docs=self.webpackChunkcli_for_microsoft_365_docs||[]).push([[13059],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},f=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=l(n),f=i,d=m["".concat(c,".").concat(f)]||m[f]||u[f]||r;return n?o.createElement(d,a(a({ref:t},p),{},{components:n})):o.createElement(d,a({ref:t},p))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=f;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[m]="string"==typeof e?e:i,a[1]=s;for(var l=2;l<r;l++)a[l]=n[l];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}f.displayName="MDXCreateElement"},82855:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var o=n(87462),i=(n(67294),n(3905));const r={sidebar_position:1},a="Persisting connection information",s={unversionedId:"concepts/persisting-connection",id:"concepts/persisting-connection",title:"Persisting connection information",description:"After logging in to Microsoft 365, the CLI for Microsoft 365 will persist the information about the connection until you explicitly log out from Microsoft 365.",source:"@site/docs/concepts/persisting-connection.md",sourceDirName:"concepts",slug:"/concepts/persisting-connection",permalink:"/cli-microsoft365-docusaurus/concepts/persisting-connection",draft:!1,editUrl:"https://github.com/pnp/cli-microsoft365/blob/main/docs/docs/concepts/persisting-connection.md",tags:[],version:"current",lastUpdatedAt:1681508105,formattedLastUpdatedAt:"Apr 14, 2023",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"concepts",next:{title:"Authorization and access tokens",permalink:"/cli-microsoft365-docusaurus/concepts/authorization-tokens"}},c={},l=[{value:"Why is persisting connection information important",id:"why-is-persisting-connection-information-important",level:2},{value:"Convenience",id:"convenience",level:3},{value:"Building scripts",id:"building-scripts",level:3},{value:"Persisting connection information in CLI for Microsoft 365",id:"persisting-connection-information-in-cli-for-microsoft-365",level:2},{value:"Removing persisted connection information",id:"removing-persisted-connection-information",level:2}],p={toc:l},m="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"persisting-connection-information"},"Persisting connection information"),(0,i.kt)("p",null,"After logging in to Microsoft 365, the CLI for Microsoft 365 will persist the information about the connection until you explicitly log out from Microsoft 365."),(0,i.kt)("h2",{id:"why-is-persisting-connection-information-important"},"Why is persisting connection information important"),(0,i.kt)("p",null,"Persisting connection information is important for two reasons."),(0,i.kt)("h3",{id:"convenience"},"Convenience"),(0,i.kt)("p",null,"First of all it's more convenient to use the CLI for Microsoft 365. If you're using it often to manage a specific tenant, you can connect once and the CLI will remember your credentials. The next time you start the CLI, you can directly start managing your tenant without having to authenticate first."),(0,i.kt)("h3",{id:"building-scripts"},"Building scripts"),(0,i.kt)("p",null,"When working with CLI for Microsoft 365, each command is executed in an isolated context and has no access to the memory of any command executed before. So unless you would store the connection information in a variable and explicitly pass it to each command, the CLI would be unable to log in to your tenant. As you can imagine, working with the CLI in this way would be tedious and inconvenient."),(0,i.kt)("p",null,"By persisting the connection information the CLI for Microsoft 365 can be used to build scripts, for example:"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Deploy all apps that are not yet deployed in the tenant app catalog:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"m365 # get all apps available in the tenant app catalog\napps=$(m365 spo app list -o json)\n\n# get IDs of all apps that are not deployed\nnotDeployedAppsIds=($(echo $apps | jq -r '.[] | select(.Deployed == false) | {ID} | .[]'))\n\n# deploy all not deployed apps\nfor appId in $notDeployedAppsIds; do\n  m365 spo app deploy -i $appId\ndone\n")),(0,i.kt)("p",null,"First, you use the CLI for Microsoft 365 to get the list of all apps from the tenant app catalog using the ",(0,i.kt)("inlineCode",{parentName:"p"},"spo app list")," command. You set the output type to JSON and store it in a shell variable ",(0,i.kt)("inlineCode",{parentName:"p"},"apps"),". Next, you parse the JSON string using ",(0,i.kt)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},"jq")," and get IDs of apps that are not deployed. Finally, for each ID you run the ",(0,i.kt)("inlineCode",{parentName:"p"},"spo app deploy")," CLI for Microsoft 365 command passing the ID as a command argument. Notice, that in the script, both ",(0,i.kt)("inlineCode",{parentName:"p"},"spo")," commands are run as separate commands directly in the shell. In both cases, the shell starts the CLI, executes the specified command and closes the CLI removing all of its resources from memory. Scripts, like the one mentioned above can work, because the CLI for Microsoft 365 persists its connection information."),(0,i.kt)("h2",{id:"persisting-connection-information-in-cli-for-microsoft-365"},"Persisting connection information in CLI for Microsoft 365"),(0,i.kt)("p",null,"When you log in to Microsoft 365 in the CLI for Microsoft 365, the CLI will persist the information about the connection for future reuse. For the established connection, the CLI for Microsoft 365 persists the refresh token as well as all access tokens obtained when using the different CLI commands."),(0,i.kt)("p",null,"Depending on the CLI for Microsoft 365 commands you have used, the CLI might persist some additional information. For example, when using commands that interact with SharePoint Online, the CLI will store the URL of your SharePoint Online tenant as well as its ID."),(0,i.kt)("p",null,"The CLI for Microsoft 365 stores its connection information in two JSON files located in the home directory of the current user. On MacOS and Linux, these are ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.cli-m365-tokens.json")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.cli-m365-msal.json"),". On Windows, this is ",(0,i.kt)("inlineCode",{parentName:"p"},"<root>\\Users\\<username>\\.cli-m365-tokens.json")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"<root>\\Users\\<username>\\.cli-m365-msal.json"),". The ",(0,i.kt)("inlineCode",{parentName:"p"},"tokens")," file serves as a quick lookup of tokens to speed up command execution. The ",(0,i.kt)("inlineCode",{parentName:"p"},"msal")," file is the cache of the ",(0,i.kt)("inlineCode",{parentName:"p"},"msal-node")," library used by CLI for Microsoft 365 to authenticate to Microsoft 365. Contents of both these files are not encrypted."),(0,i.kt)("h2",{id:"removing-persisted-connection-information"},"Removing persisted connection information"),(0,i.kt)("p",null,"CLI for Microsoft 365 persists its connection information until you either explicitly log out from the particular service or manually remove the stored credentials."),(0,i.kt)("p",null,"To check if you are logged in to Microsoft 365 in the CLI for Microsoft 365, run the ",(0,i.kt)("inlineCode",{parentName:"p"},"status")," command. If you are logged in, the command will return the name of the user account or AAD application used to log in. If you are not connected, the command will return ",(0,i.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,i.kt)("p",null,"To log out from Office, run the ",(0,i.kt)("inlineCode",{parentName:"p"},"logout")," command. Running this command will remove all previously stored connection data from your machine."))}u.isMDXComponent=!0}}]);