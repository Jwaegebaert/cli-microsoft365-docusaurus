"use strict";(self.webpackChunkcli_for_microsoft_365_docs=self.webpackChunkcli_for_microsoft_365_docs||[]).push([[71566],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n,i,s={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var a=i.createContext({}),c=function(e){var t=i.useContext(a),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=c(e.components);return i.createElement(a.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,a=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=s,h=d["".concat(a,".").concat(m)]||d[m]||p[m]||o;return n?i.createElement(h,r(r({ref:t},u),{},{components:n})):i.createElement(h,r({ref:t},u))}));function h(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var a in t)hasOwnProperty.call(t,a)&&(l[a]=t[a]);l.originalType=e,l[d]="string"==typeof e?e:s,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},25107:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=n(87462),s=(n(67294),n(3905));const o={tags:["users","security"]},r="Add a Site Collection Admin using a csv file",l={unversionedId:"sample-scripts/spo/add-site-collection-admin-using-csv-file/index",id:"sample-scripts/spo/add-site-collection-admin-using-csv-file/index",title:"Add a Site Collection Admin using a csv file",description:'When you decide to add users for all your Site Collections, you can\'t simply run through all the sites in your tenant. Why? Because what you "see" in the SPO admin center, is not reflecting what you really have. There a few Site Collections that are not visible. A few examples would be:',source:"@site/docs/sample-scripts/spo/add-site-collection-admin-using-csv-file/index.md",sourceDirName:"sample-scripts/spo/add-site-collection-admin-using-csv-file",slug:"/sample-scripts/spo/add-site-collection-admin-using-csv-file/",permalink:"/cli-microsoft365-docusaurus/sample-scripts/spo/add-site-collection-admin-using-csv-file/",draft:!1,editUrl:"https://github.com/pnp/cli-microsoft365/blob/main/docs/docs/sample-scripts/spo/add-site-collection-admin-using-csv-file/index.md",tags:[{label:"users",permalink:"/cli-microsoft365-docusaurus/tags/users"},{label:"security",permalink:"/cli-microsoft365-docusaurus/tags/security"}],version:"current",lastUpdatedAt:1671570658,formattedLastUpdatedAt:"Dec 20, 2022",frontMatter:{tags:["users","security"]},sidebar:"sampleScripts",previous:{title:"Add multiple lists in multiple sites",permalink:"/cli-microsoft365-docusaurus/sample-scripts/spo/add-multiple-lists-in-multiple-sites/"},next:{title:"Add users to the Associated SharePoint Groups of a site from a CSV File",permalink:"/cli-microsoft365-docusaurus/sample-scripts/spo/add-users-associatedspgroup-site-csv-file/"}},a={},c=[{value:"Get all the Site Collections in your tenant",id:"get-all-the-site-collections-in-your-tenant",level:2},{value:"Add the user as Site Collection Admin",id:"add-the-user-as-site-collection-admin",level:2}],u={toc:c},d="wrapper";function p(e){let{components:t,...n}=e;return(0,s.kt)(d,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"add-a-site-collection-admin-using-a-csv-file"},"Add a Site Collection Admin using a csv file"),(0,s.kt)("admonition",{type:"danger"},(0,s.kt)("p",{parentName:"admonition"},'When you decide to add users for all your Site Collections, you can\'t simply run through all the sites in your tenant. Why? Because what you "see" in the SPO admin center, is not reflecting what you ',(0,s.kt)("em",{parentName:"p"},"really")," have. There a few Site Collections that are not visible. A few examples would be:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"- Search\n- My Site (contoso-my.sharepoint.com)\n- sites created with Private Channels\n\nSites created with Private Channels are not (yet?) visible in the SharePoint Online admin center, so adding users as Site Collection Admins into those could cause chaos! It's safer to get a list of all your sites, and keep the intended ones in your csv file to feed the script.\n")),(0,s.kt)("h2",{id:"get-all-the-site-collections-in-your-tenant"},"Get all the Site Collections in your tenant"),(0,s.kt)("p",null,"To get all the Site Collections in your tenant and export to a .csv file, you can run the following:"),(0,s.kt)("p",null,'=== "PowerShell"'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'```powershell\n$allSites = m365 spo site list --query "[?Template!=\'SRCHCEN#0\']" | ConvertFrom-Json\n$results = @()\n\nforeach($site in $allSites){\n    $results += [pscustomobject][ordered]@{\n        Title = $site.Title\n        Url = $site.Url\n        Template = $site.Template\n    }\n}\n$results | Export-Csv -Path "<YOUR-CSV-FILE-PATH>"\n```\n')),(0,s.kt)("p",null,"The script above has a query to ignore the ",(0,s.kt)("em",{parentName:"p"},"Search")," site collection by filtering with the template code. If for example you wish to only get the sites that have been created with Private Channels, you could amend your query as follows:"),(0,s.kt)("p",null,'=== "PowerShell"'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"```powershell\n$privateChannelSites = m365 spo site list --query \"[?Template=='TEAMCHANNEL#0']\" | ConvertFrom-Json\n```\n")),(0,s.kt)("h2",{id:"add-the-user-as-site-collection-admin"},"Add the user as Site Collection Admin"),(0,s.kt)("p",null,"Once you've got the .csv file from the script above, filter it to your needs to keep only the targeted sites, and use it in the script below."),(0,s.kt)("admonition",{type:"note"},(0,s.kt)("p",{parentName:"admonition"},'The script will add the user as a "site admin" on classic and non group-connected sites, or a an "additional admin" in group-connected sites (and not as a group Member).')),(0,s.kt)("p",null,'=== "PowerShell"'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'```powershell\n$csvSites = Import-Csv -Path "<YOUR-CSV-FILE-PATH>"\n$UserToAdd = "john.smith@contoso.com"  ## Change to your user\n$siteCount = $csvSites.Count\n\nWrite-Host "Processing $siteCount sites..." -f Cyan\n\n#Loop through the sites in the csv file\nforeach($site in $csvSites){\n    Write-Host "Going through $($site.Title)" \n    \n    $users = m365 spo user list --webUrl $site.Url -o json | ConvertFrom-Json\n    $admins = $users.value | Where-Object {$_.IsSiteAdmin -eq $true}\n        \n        if ($admins.Email -eq $UserToAdd) {\n            Write-Host "User $($UserToAdd) is already an Admin in $($site.Title)." -f Green\n        }\n        else{\n            Write-Host "Adding $($UserToAdd) to $($site.Title). " -f Magenta\n            m365 spo site set --url $site.Url --owners $UserToAdd\n        }\n}\n```\n')))}p.isMDXComponent=!0}}]);